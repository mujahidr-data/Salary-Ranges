# Release Notes: v3.7.0 - Corrected X0 Ranges & Two Separate Calculators

## üéØ Overview
This release corrects the range definitions for X0 (Engineering & Product) and implements two separate calculator sheets with proper naming and filtered job family dropdowns.

## üìä Range Definitions (CORRECTED)

### X0 - Engineering and Product
- **Range Start**: P25 (25th percentile)
- **Range Mid**: P62.5 (62.5th percentile) ‚Üê **CHANGED** from P50
- **Range End**: P90 (90th percentile)

### Y1 - Everyone Else
- **Range Start**: P10 (10th percentile)
- **Range Mid**: P40 (40th percentile)
- **Range End**: P62.5 (62.5th percentile)

## üñ•Ô∏è Calculator Sheets

### Two Separate Calculators:
1. **"Engineering and Product"** (X0 only)
   - Job Family dropdown shows only X0-eligible families
   - Region dropdown (US, India, UK)
   - Currency dropdown (Local, USD)

2. **"Everyone Else"** (Y1 only)
   - Job Family dropdown shows only Y1-eligible families
   - Region dropdown (US, India, UK)
   - Currency dropdown (Local, USD)

## üìã Full List Structure (21 columns)

| Column | Name | Description |
|--------|------|-------------|
| A | Site | Region name |
| B | Region | US, India, UK |
| C | Aon Code (base) | Base Aon code without suffix |
| D | Job Family (Exec) | Executive description |
| E | Category | X0 or Y1 |
| F | CIQ Level | L2 IC, L3 IC, etc. |
| G-M | P10-P90 | All percentiles from Aon data |
| **N** | **Range Start** | P25 for X0, P10 for Y1 (with fallback) |
| **O** | **Range Mid** | P62.5 for X0, P40 for Y1 (with fallback) |
| **P** | **Range End** | P90 for X0, P62.5 for Y1 (with fallback) |
| Q | Internal Min | Minimum salary from Bob data |
| R | Internal Median | Median salary from Bob data |
| S | Internal Max | Maximum salary from Bob data |
| T | Emp Count | Number of employees |
| **U** | **Key** | JobFamily+Level+Region (lookup key) |

## üîß Technical Changes

### 1. Category Definitions Updated
```javascript
const CATEGORY_DEFINITIONS = {
  'X0': { 
    min: 'P25', 
    mid: 'P625',  // Changed from 'P50'
    max: 'P90',
    label: 'Engineering & Product'
  },
  'Y1': { 
    min: 'P10', 
    mid: 'P40', 
    max: 'P625',
    label: 'Everyone Else'
  }
};
```

### 2. Range Columns Auto-Populated
The Full List now automatically populates Range Start/Mid/End columns based on category:
- **X0 rows**: Range Start = P25, Range Mid = P62.5, Range End = P90
- **Y1 rows**: Range Start = P10, Range Mid = P40, Range End = P62.5

### 3. Fallback Logic
If a required percentile is missing, the system falls back to the next higher percentile:
- **X0**: P25 missing ‚Üí P40 ‚Üí P50; P62.5 missing ‚Üí P75 ‚Üí P90
- **Y1**: P10 missing ‚Üí P25 ‚Üí P40; P40 missing ‚Üí P50 ‚Üí P62.5; P62.5 missing ‚Üí P75 ‚Üí P90

### 4. Calculator Formulas
Both calculators use **XLOOKUP** with currency awareness:
```
=IF($B$4="Local", 
  XLOOKUP($B$2&$A8&$B$3, 'Full List'!$U:$U, 'Full List'!$N:$N, ""),
  XLOOKUP($B$2&$A8&$B$3, 'Full List USD'!$U:$U, 'Full List USD'!$N:$N, "")
)
```
- **$B$2**: Job Family
- **$A8**: Level (e.g., "L5 IC")
- **$B$3**: Region
- **$B$4**: Currency toggle

### 5. Full List USD
The Full List USD sheet:
- Converts all market percentiles (P10-P90) using FX rates
- Converts Range Start/Mid/End columns
- Rounds all market values to nearest $100
- Maintains internal stats in local currency

## üé® Visual Changes

### Red Tab Colors
All automated sheets now have **red tab colors** for easy identification:
- Aon US/India/UK - 2025
- Base Data, Bonus History, Comp History, Performance Ratings
- Lookup
- Full List, Full List USD
- Employees (Mapped)
- Engineering and Product (calculator)
- Everyone Else (calculator)

## üìñ Workflow (3 Steps)

1. **Fresh Build**: Creates all placeholder sheets, Lookup sheet, both calculators
2. **Import Bob Data**: Imports Base Data, Bonus, Comp, Performance Ratings
3. **Build Market Data**: Generates Full List and Full List USD from Aon sheets

## üöÄ Deployment

```bash
# Commit and push to Git
git add -A
git commit -m "feat: Correct X0 ranges and add separate calculators v3.7.0"
git push

# Deploy to Google Apps Script
clasp push
```

## ‚úÖ Testing Checklist

- [ ] Fresh Build creates both "Engineering and Product" and "Everyone Else" sheets
- [ ] X0 calculator dropdown shows only X0 families
- [ ] Y1 calculator dropdown shows only Y1 families
- [ ] Range Start/Mid/End columns in Full List match category definitions
- [ ] X0 ranges: P25 ‚Üí P62.5 ‚Üí P90
- [ ] Y1 ranges: P10 ‚Üí P40 ‚Üí P62.5
- [ ] Currency toggle switches between Local and USD correctly
- [ ] All automated sheets have red tabs
- [ ] XLOOKUP formulas use column U for Key
- [ ] Internal stats use columns Q, R, S, T

## üìù Migration Notes

If you have an existing spreadsheet:
1. Run **Fresh Build** to create new calculator sheets
2. Delete old "Salary Ranges" sheet (if present)
3. Run **Import Bob Data** to refresh data
4. Run **Build Market Data** to regenerate Full List with Range columns

## üêõ Bug Fixes

- Fixed X0 range mid from P50 to P62.5
- Fixed Full List to include Range Start/Mid/End columns
- Fixed calculator formulas to reference correct columns (U for Key, N/O/P for ranges)
- Fixed column references after adding Range columns

---

**Version**: 3.7.0  
**Date**: November 27, 2025  
**Status**: ‚úÖ Deployed to Git & Google Apps Script

